"use strict"var aspNetId = "";function setupSignalRConnection(Reqid) {    const connection = new signalR.HubConnectionBuilder()        .withUrl(`/chatHub?Reqid=${Reqid}`)        .withAutomaticReconnect()        .build();    connection.on("ReceiveMessage", (user, message) => {        if (message) {            const chatsDiv = document.getElementById("chats");            const messageContainer = document.createElement("div");            messageContainer.classList.add("message-container");            const contentDiv = document.createElement("div");            contentDiv.classList.add("content");            const messageDiv = document.createElement("div");            const msg = message.replace(/&/g, "&").replace(/</g, "<");            let encodedMsg;            if (user == "You") {                encodedMsg = msg;                messageContainer.classList.add("right-align");                toastr.success("Messsage sent");            } else {                encodedMsg = msg;                messageContainer.classList.add("left-align");                toastr.success("Ting tong!!!");            }            messageDiv.textContent = encodedMsg;            const timeDiv = document.createElement("div");            const now = new Date();            const hour = now.getHours().toString().padStart(2, '0');            const minute = now.getMinutes().toString().padStart(2, '0');            timeDiv.classList.add("time");            timeDiv.textContent = `${hour}:${minute}`;            contentDiv.appendChild(messageDiv);            contentDiv.appendChild(timeDiv);            messageContainer.appendChild(contentDiv);            chatsDiv.appendChild(messageContainer);            chatsDiv.scrollTop = chatsDiv.scrollHeight;            console.log(user, message);        }    });    connection.onclose(function (error) {        console.log("Connection closed:", error);        startConnection();    });    document.getElementById("sendMessage").addEventListener("click", event => {        const message = document.getElementById("userMessage").value;        const receiverId = document.getElementById("receiverId").value;        const Reqid = document.getElementById("ChatRequestID").value;        document.getElementById("userMessage").value = "";        if (receiverId) {            connection.invoke("SendMessage", Reqid, receiverId, message).catch(err => console.error(err.toString()));            $.ajax({                method: "GET",                url: "/Admin/AddChatDetails",                data: { Reqid: Reqid, receiverId: receiverId, message: message },                success: function (data) {                    console.log(data);                }            });            console.log("Message Sent");        } else {            console.error("Receiver ID is missing.");        }        event.preventDefault();    });    function startConnection() {        connection.start().then(function () {            console.log("SignalR connected");        }).catch(function (err) {            console.error("Error starting SignalR connection:", err.toString());            setTimeout(startConnection, 10000);        });    }    startConnection();}function CreateConnection(Reqid, ReciverAspid, Phyid) {    var physicianId = Phyid;    aspNetId = ReciverAspid;    $('#receiverId').val(aspNetId);    $('#ChatRequestID').val(Reqid);    if (ReciverAspid) {        $.ajax({            method: "GET",            url: "/Admin/ChatPersonDetails",            data: { Reqid: Reqid, ReciverAspid: ReciverAspid },            success: function (data) {                $('#UserName').text(data.receiverName);                const chatsDiv = document.getElementById("chats");                $('#chats').empty();                var chatDiv = document.getElementById("chats");                var startdate = null;                data.chatHistories.forEach(history => {                    const messageContainer = document.createElement("div");                    messageContainer.classList.add("message-container");                    const contentDiv = document.createElement("div");                    contentDiv.classList.add("content");                    const messageDiv = document.createElement("div");                    const msg = history.message;                    let encodedMsg;                    if (history.receiverAspId == ReciverAspid) {                        encodedMsg = msg;                        messageContainer.classList.add("right-align");                    } else {                        encodedMsg = msg;                        messageContainer.classList.add("left-align");                    }                    messageDiv.textContent = encodedMsg;                    const timeDiv = document.createElement("div");                    const time = history.time.substring(0, 5);                    timeDiv.classList.add("time");                    timeDiv.textContent = time;                    const dateDiv = document.createElement("div");                    let createdDate = new Date(history.createdDate);                    let createdDateString = createdDate.toLocaleDateString('en-CA'); // Format as YYYY-MM-DD in local time                    if (startdate !== createdDateString || startdate === null) {                        startdate = createdDateString;                        let options = { day: '2-digit', month: 'short', year: 'numeric' };                        let printDate = createdDate.toLocaleDateString('en-US', options);                        dateDiv.textContent = printDate;                        dateDiv.classList.add("date-section");                        chatDiv.appendChild(dateDiv);                    }                    contentDiv.appendChild(messageDiv);                    contentDiv.appendChild(timeDiv);                    messageContainer.appendChild(contentDiv);                    chatsDiv.appendChild(messageContainer);                });                chatsDiv.scrollTop = chatsDiv.scrollHeight;            }        });    }    setupSignalRConnection(Reqid);}$('#offcanvasRight').on('hide.bs.offcanvas', function () {    document.getElementById("chats").innerHTML = "";})function showSendBtn() {    var inputField = $('.userMessage');    var sendButton = $('.sendMessage');    var send = $('#bi-send');    if (inputField.val().trim() == "") {        sendButton.prop('disabled', true);        $('#send').removeClass('text-dark');        $('#send').addClass('text-white');    }    else {        sendButton.prop('disabled', false);        $('#send').addClass('text-dark');        $('#send').removeClass('text-white');    }}if (typeof fullscreenExitButton === 'undefined') {    const fullscreenExitButton = document.querySelector('.smallscreen');    if (fullscreenExitButton) {        fullscreenExitButton.addEventListener('click', () => {            var current_height = document.getElementById('offcanvasRight').classList;            if (!current_height.contains('custom-height')) {                $('#offcanvasRight').addClass('custom-height');                $('#small_screen_icon').addClass('d-none');                $('#full_screen_icon').removeClass('d-none');            } else {                $('#offcanvasRight').removeClass('custom-height');                $('#small_screen_icon').removeClass('d-none');                $('#full_screen_icon').addClass('d-none');            }        });    } else {        Swal.fire("Oops", "Element with class \"smallscreen\" not found", "error");    }}