@model hellodoc.DAL.ViewModels.ProviderInvoicingVm

<link rel="stylesheet" href="~/css/invoicing.css" asp-append-version="true" />

<div class="container">
    <h4 class="mb-md-3 mb-1 p-1 p-md-2 ">Timesheets</h4>

    <div class="border rounded shadow p-3">
        <div class="d-lg-flex justify-content-between align-items-center mb-3">

            <div class="">
                <form role="search" class="border border-rounded rounded border-info mb-2">
                    <div class="form-floating" id="biWeeklyId">
                        <select id="searchByTimeperiod" class="form-select border-0 TimesheetperiodDropdown ps-3 shadow" onchange="GetProviderInvoicing()" aria-label="Default select example">
                        </select>
                        <label for="searchByTimeperiod" class="primary">Search by Timesheetperiod</label>
                    </div>
                </form>
            </div>

            @if (@Model.TimesheetsFinalize != true)
            {
                <div class="mt-3 mt-lg-0" id="buttonProvider">
                    <button type="button" class="btn btn-outline-info fw-semibold shadow" onclick="OpenFinalizeTimeSheet()">
                        Finalize TimeSheet
                    </button>
                </div>
            }
        </div>

        <div class="table-responsive d-lg-block d-none">
            <table class="table TimesheetPeriodTable">
                <thead class="rounded table-active">
                    <tr>
                        <th>Shift Date</th>
                        <th>Shift</th>
                        <th>Nightshift Weekend</th>
                        <th>Houscall</th>
                        <th>Phone Consults</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var obj in @Model.Timesheetdetails!)
                    {
                        <tr class="align-middle">
                            <td>@obj.TimesheetDate.ToString("MMM dd, yyyy")</td>
                            <td>@obj.TotalHours</td>
                            <td class="text-center">
                                <input type="checkbox" class="form-check-input checkbox fileCheckbox" disabled @(obj.IsWeekend == true ? "checked" : "") />
                            </td>
                            <td>@obj.NumberOfHouseCall</td>
                            <td>@obj.NumberOfPhoneCall</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="border rounded shadow d-block d-lg-none">
            <div class="accordion container-fluid p-0" id="accordionPanelsStayOpenExample">
                <table class="w-100 TimesheetPeriodTable">
                    <thead>
                        <tr>
                            <th class="d-none"></th>
                            <th class="d-none"></th>
                        </tr>
                    </thead>
                    @{
                        var counter = 1;
                    }
                    <tbody>
                        @foreach (var obj in @Model.Timesheetdetails!)
                        {
                            <tr class="d-flex flex-column">
                                <td>
                                    <h2 class="accordion-header" id="flush-heading@(counter)"></h2>

                                    <div class="accordion-button collapsed d-flex flex-column pb-0"
                                         data-bs-toggle="collapse" data-bs-target="#flush-collapse@(counter)"
                                         aria-expanded="false" aria-controls="flush-collapse@(counter)">

                                        <div class="w-100 ">
                                            <span class="fw-bolder">
                                                @obj.TimesheetDate.ToString("MMM dd, yyyy")
                                            </span>
                                        </div>
                                    </div>

                                </td>
                                <td class="p-0">
                                    <div id="flush-collapse@(counter)" class="accordion-collapse collapse"
                                         aria-labelledby="flush-heading@(counter)" data-bs-parent="#accordionFlushExample">
                                        <div class="accordion-body main-flex pt-0">
                                            <div class="inner-flex pt-2 mobile-font">
                                                <span class="fw-bolder">Shift</span>: @obj.TotalHours
                                            </div>
                                            <div class="inner-flex mobile-font">
                                                <span class="fw-bolder">NightShift Weekend</span>: <input type="checkbox" class="form-check-input checkbox fileCheckbox" disabled @(obj.IsWeekend == true ? "checked" : "") />
                                            </div>
                                            <div class="inner-flex mobile-font">
                                                <span class="fw-bolder">Houscall</span>: @obj.NumberOfHouseCall
                                            </div>
                                            <div class="inner-flex mobile-font">
                                                <span class="fw-bolder">Phone Consults</span>: @obj.NumberOfPhoneCall
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="border rounded shadow p-3 mt-5">
        <h4 class="mb-md-3 mb-1 p-1 p-md-2 ">Timesheet Reimbursement</h4>
        <div class="table-responsive d-lg-block d-none">
            <table class="table ReimbursementTable">
                <thead class="rounded table-active">
                    <tr>
                        <th>Date</th>
                        <th>Item</th>
                        <th>Amount</th>
                        <th>Bill</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var obj in @Model.Timesheetdetailreimbursements!)
                    {
                        <tr class="align-middle">
                            <td>@obj.TimesheetDate?.ToString("MMM dd, yyyy")</td>
                            <td>@obj.ItemName</td>
                            <td>@obj.Amount</td>
                            <td>@obj.Bill</td>
                            <td>
                                @if (@obj.Bill != null)
                                {
                                    <a type="button" class="btn btn-outline-info fw-semibold" target="_blank" href="~/content/@obj.Bill">View</a>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="border rounded shadow d-block d-lg-none">

            <div class="accordion container-fluid p-0" id="accordionPanelsStayOpenExample1">
                <table class="w-100 ReimbursementTable">
                    <thead>
                        <tr>
                            <th class="d-none"></th>
                            <th class="d-none"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="d-flex flex-column">
                            <td>
                                <h2 class="accordion-header" id="flush-heading2@(counter)"></h2>

                                <div class="accordion-button collapsed d-flex flex-column pb-0" data-bs-toggle="collapse"
                                     data-bs-target="#flush-collapse2@(counter)" aria-expanded="false"
                                     aria-controls="flush-collapse2@(counter)">

                                    <div class="w-100 ">
                                        <span class="fw-bolder">
                                            Mar 1,2024
                                        </span>
                                    </div>

                                </div>

                            </td>
                            <td class="p-0">
                                <div id="flush-collapse2@(counter)" class="accordion-collapse collapse"
                                     aria-labelledby="flush-heading2@(counter)" data-bs-parent="#accordionFlushExample2">
                                    <div class="accordion-body main-flex pt-0">
                                        <div class="inner-flex pt-2 mobile-font">
                                            <span class="fw-bolder">Item</span>: Medicines
                                        </div>
                                        <div class="inner-flex mobile-font">
                                            <span class="fw-bolder">Amount</span>: 10
                                        </div>
                                        <div class="inner-flex mobile-font">
                                            <span class="fw-bolder">Bill</span>: dummy-test-file_212.pdf
                                        </div>
                                        <div class="inner-flex mobile-font">
                                            <button type="button" class="btn btn-outline-info">
                                                View
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('.ReimbursementTable').DataTable({
            "initComplete": function (settings, json) {

                $('#my-search-input2').val(settings.oPreviousSearch.sSearch);

                $('#my-search-input2').on('keyup', function () {
                    var searchValue = $(this).val();
                    settings.oPreviousSearch.sSearch = searchValue;
                    settings.oApi._fnReDraw(settings);
                });
            },
            "pageLength": 5,
            pagingType: "full",

            language: {
                oPaginate: {
                    sNext: '<i class="bi bi-caret-right-fill text-info"></i>',
                    sPrevious: '<i class="bi bi-caret-left-fill text-info"></i>'

                }
            }
        });
        $('.dataTables_length').hide();
        $('.dataTables_filter').hide();
    });
</script>

<script>
    timePeriodForSelect();

    function timePeriodForSelect() {
        var dropdown = document.getElementById("searchByTimeperiod");
        var currentDate = new Date();
        var currentYear = currentDate.getFullYear();
        var currentMonth = currentDate.getMonth() + 1;
        dropdown.innerHTML = "";

        for (var month = 1; month <= currentMonth; month++) {
            var daysInMonth = new Date(currentYear, month, 0).getDate();
            var monthname = "";
            if (month == 1) { monthname = "Jan" }
            else if (month == 2) { monthname = "Feb" }
            else if (month == 3) { monthname = "Mar" }
            else if (month == 4) { monthname = "Apr" }
            else if (month == 5) { monthname = "May" }
            else if (month == 6) { monthname = "Jun" }
            else if (month == 7) { monthname = "Jul" }
            else if (month == 8) { monthname = "Aug" }
            else if (month == 9) { monthname = "Sep" }
            else if (month == 10) { monthname = "Oct" }
            else if (month == 11) { monthname = "Nov" }
            else if (month == 12) { monthname = "Dec" }

            var option1 = document.createElement("option");
            option1.value = month + "-1";
            option1.text = "1 " + monthname + ", " + currentYear + " - 15 " + monthname + ", " + currentYear;
            dropdown.appendChild(option1);

            var option2 = document.createElement("option");
            option2.value = month + "-2";
            option2.text = "16 " + monthname + ", " + currentYear + " - " + daysInMonth + " " + monthname + ", " + currentYear;
            dropdown.appendChild(option2);
        }

        var currentDay = currentDate.getDate();
        var currentMonthOption = currentMonth + "-" + (currentDay <= 15 ? "1" : "2");
        dropdown.querySelector("option[value='" + currentMonthOption + "']").selected = true;
    }
</script>

